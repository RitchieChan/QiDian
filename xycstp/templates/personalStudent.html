{% extends 'personalBase.html' %}

{% block privateCSS %}
<link rel="stylesheet" href="/static/css/student.css">
<link rel="stylesheet" href="/static/css/authenticate.css">
{% endblock %}

{% block body %}
<nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#4f8cd4;">
  <div class="container">
    <a class="navbar-brand" href="/">
      <img src="/static/img/qidian.png" height="50px" class="d-inline-block align-top m-auto" alt="星云大学生家教平台">
      <div style="height:50px;line-height:50px" class="h4 d-inline-block">星云 大学生家教平台</div>
    </a>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="/">主页</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/findTutor/">导师</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/bbs/">学习社区</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/train/">题库</a>
        </li>
        <li class="nav-item active">
          <a class="nav-link">个人中心</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- 整体内容 -->
<div class="row m-0">
    <!-- 左侧导航 -->
    <div class="con-left col-md-2 p-0" id="personal" style="height: 1120px;">
      <div class="row">
        <!-- 头像 -->
        <div class="col-md-10 offset-md-1">
          <img src="/static/img/qidian.png" class="rounded img-fluid" alt="头像">
        </div>

      </div>
      <div class="row">
        <div class="center h5"> 用户名：{{user}}</div>
      </div>
      <div class="con-left-content" id="person1" data-son-id="#person2">
        个人信息<i class="fa fa-arrow-circle-right"></i>
      </div>
      <div class="con-left-content" id="mystudent1" data-son-id="#mystudent2">
        我的导师<i class="fa fa-arrow-circle-right"></i>
      </div>
      <div class="con-left-content" id="doc1" data-son-id="#doc2">
        文件下载/上传
        <i class="fa fa-arrow-circle-right"></i>
      </div>
      <div class="con-left-content" id="com1" data-son-id="#com2">
        导师1V1交流
        <i class="fa fa-arrow-circle-right"></i>
      </div>
      <div class="con-left-content" onclick="javascript:window.location.href='/personal/logout/'">
        退出账号
        <i class="fa fa-arrow-circle-right"></i>
      </div>
    </div>
    <!-- 右侧内容 -->
    <div class="content col-md-10 p-0">

      <div id="person2" class="content-right">
        <!-- <div class="card-header">信息中心</div> -->
        <div>
          <div class="card-header">
            <legend>
              <h3>个人信息</h3>
            </legend>
          </div>
          <div class="std-inf">
            <table>
              <tbody>
                <tr>
                  <td class="td_topcol" style="width:180px;"></td>
                  <td class="td_topcol"></td>
                </tr>
                <tr>
                  <td colspan="2">
                    <div class="tb_tit">账号信息</div>
                  </td>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*</span>昵称：</td>
                  <td><input class="form-control" type="text" id="login_name" value=""></td>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*</span>密码：</td>
                  <td><input class="form-control" type="password" id="login_pass" value=""><span
                      class="v_result"></span></td>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*</span>手机号：</td>
                  <td><input class="form-control" type="email" id="login_email" value=""><span class="v_result"></span>
                  </td>
                </tr>
                <!-- <tr>
                                    <td align="right"><span class="fim">*</span>验证码：</td>
                                    <td><input class="form-control" type="email" id="login_email" value="" style="width: 100px;"><span class="v_result"></span></td>
                                </tr> -->
                <tr>
                  <td align="right"><span class="fim"></span>邮箱：</td>
                  <td><input class="form-control" type="tel" id="login_tel" value=""><span class="v_result"></span></td>
                </tr>
                <tr>
                  <td align="right"><span class="fim"></span>QQ：</td>
                  <td><input class="form-control" type="text" id="login_qq" value=""><span class="v_result"></span></td>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*</span>身份：</td>
                  <td >&nbsp;&nbsp;<input type="radio"id="shenfeng1" name="shenfeng" value="std" checked>&nbsp;学生&nbsp;&nbsp;
                    <input type="radio" id="shenfeng2"  name="shenfeng" value="tea">&nbsp;老师<span class="v_result"></span></td>
                </tr>
                <tr>
                  <td colspan="2">
                    <div class="tb_tit">基本信息</div>
                  </td>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*</span>姓名：</td>
                  <td><input class="form-control" type="text" id="vol_true_name" value="" style="width: 206px;"><span
                      class="v_result"></span></td>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*</span>性别：</td>
                  <td>&nbsp;&nbsp;<input type="radio" name="gender" value="0" checked="">&nbsp;女&nbsp;&nbsp;<input
                      type="radio" name="gender" value="1" >&nbsp;男<span class="v_result"></span></td>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*</span>出生日期：</td>
                  <td class="input-group date" id="datetimepicker1" data-target-input="nearest">
                    <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                        <div class="input-group-text" style="cursor:pointer"><i class="fa fa-calendar"></i></div>
                    </div>
                    <input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker1"/>
                  </td>
                <tr>
                  <td align="right"><span class="fim " style="width: 184px; ">*</span>所在地区：</td>
                  <td><select class="weui_select weui-select form-control " style="width: 206px;" id="vol_nationality"
                      name="vol_nationality">
                      <option value="">请选择</option>
                      <option value="茂南区">茂南区</option>
                      <option value="高州市">高州市</option>
                      <option value="信宜市">信宜市</option>
                      <option value="化州市">化州市</option>
                      <option value="电白区">电白区</option>
                      <option value="其它区">其他区</option>
                </tr>
                <tr>
                  <td align="right"><span class="fim">*详细地址：</span></td>
                  <td><input class="form-control" type="text" id="vol_address" value="" style="width:206px;"><span
                      class="v_result"></span></td>
                </tr>
                <div class="student" style="display: none;">
                  <tr>
                    <td colspan="2">
                      <div class="tb_tit"  >家教信息（学生版）</div>
                    </td>
                  </tr>
                  <tr>
                    <td align="right"><span class="fim">*就读中学：</span></td>
                    <td><input class="form-control" type="text" id="vol_addressSchool" value="" style="width:200px;"><span
                        class="v_result"></span></td>
                  </tr>
                  <tr>
                    <td align="right"><span class="fim" style="width: 184px;">*</span>就读年级：</td>
                    <td><select class="weui_select weui-select form-control " style="width: 200px;" id="vol_nationality"
                        name="vol_nationality">
                        <option value="">请选择</option>
                        <option value="初一">初一</option>
                        <option value="初二">初二</option>
                        <option value="初三">初三</option>
                        <option value="高一">高一</option>
                        <option value="高二">高二</option>
                        <option value="高三">高三</option>
                  </tr>
                  <tr>
                    <td align="right"><span class="fim" style="width: 184px;">*</span>教师要求：</td>
                    <td><select class="weui_select weui-select form-control " style="width: 200px;" id="vol_nationality"
                        name="vol_nationality">
                        <option value="">请选择</option>
                        <option value="都行">都行</option>
                        <option value="男老师">男老师</option>
                        <option value="女老师">女老师</option>
                      </select></td>
                  </tr>
                  <tr>
                    <td align="right"><span class="fim" style="width: 184px;">*</span>辅导科目：</td>
                    <td><select class="weui_select weui-select form-control " style="width: 200px;" id="vol_nationality"
                        name="vol_nationality">
                        <option value="">请选择</option>
                        <option value="学习方法">学习方法</option>
                        <option value="语文">语文</option>
                        <option value="数学">数学</option>
                        <option value="英语">英语</option>
                        <option value="物理">物理</option>
                        <option value="化学">化学</option>
                        <option value="生物">生物</option>
                        <option value="地理">地理</option>
                        <option value="历史">历史</option>
                        <option value="政治">政治</option>
                  </tr>
                  <tr>
                    <td align="right"><span class="fim" style="width: 184px;">*</span>辅导形式：</td>
                    <td><select class="weui_select weui-select form-control " style="width: 200px;" id="vol_nationality"
                        name="vol_nationality">
                        <option value="">请选择</option>
                        <option value="线上（小假期）">线上（小假期）</option>
                        <option value="线下(寒/暑假)">线下(寒/暑假)</option>
                        <option value="两者均可">两者均可</option>
                      </select></td>
                  </tr>
                  <tr>
                    <td align="right"><span class="fim">目标分数：</span></td>
                    <td><input class="form-control" type="text" id="vol_targetPoint" value="" style="width:200px;"><span
                        class="v_result"></span></td>
                  </tr>
                  <tr>
                    <td align="right"><span class="fim">理想高中/大学：</span></td>
                    <td><input class="form-control" type="text" id="vol_targetUni" value="" style="width:200px;"><span
                        class="v_result"></span></td>
                  </tr>

                </div>


              </tbody>
            </table>
          </div>
        </div>
      </div>


      <div id="mytutor2" style="display:none" class="content-right">
        <div class="card-header">我的导师和相关课程</div>
        <div>

        </div>
      </div>

      <div id="doc2" style="display:none" class="content-right">
        <div class="card-header">文件下载/上传</div>
        <div class="row p-2 m-0">
          <div class="col-md-1 align-self-center text-center">
            返回 <li class="fa fa-mail-reply "> </li>
          </div>
          <div class="input-group col-md-6 pl-5 pr-5">
            <input type="text" class="form-control" placeholder="请输入班级名">
            <div class="input-group-append">
              <button class="btn btn-info btn-search">查找</button>
            </div>
          </div>
          <div class="col-md-4 align-self-center text-center">
            <div class="row">
              <div class="col-md-4">
                下载 <li class="fa fa-download "> </li>
              </div>
              <div class="col-md-4">
                上传 <li class="fa fa-upload "> </li>
              </div>
              <div class="col-md-4">
                删除 <li class="fa fa-trash "> </li>
              </div>
            </div>
  
          </div>
        </div>
        <table class="table table-striped table-hover">
          <thead class="thead-light">
            <tr>
              <th scope="col">序号</th>
              <th scope="col">班级</th>
              <th scope="col">老师</th>
              <th scope="col">上次更新时间</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">1</th>
              <td onclick="javascript:window.location.href='#'">Mark</td>
              <td onclick="javascript:window.location.href='#'">Otto</td>
              <td>@mdo</td>
            </tr>
            <tr>
              <th scope="row">2</th>
              <td>Jacob</td>
              <td>Thornton</td>
              <td>@fat</td>
            </tr>
            <tr>
              <th scope="row">3</th>
              <td>Larry</td>
              <td>the Bird</td>
              <td>@twitter</td>
            </tr>
            <tr>
              <th scope="row">4</th>
              <td>Larry</td>
              <td>the Bird</td>
              <td>@twitter</td>
            </tr>
          </tbody>
        </table>
  
      </div>

      <div id="com2" style="display:none;height:500px;" class="content-right">
        <div class="row m-0 p-0 h-100">
  
          <div class="col-md-2 m-0 p-0 h-100 chatPeopleList" style="border-bottom:1px solid grey">
            {% for data in chatData %}
            <li class="chatPeople border-bottom" data-id="{{data.0.id}}">
              <img src="/static/img/qidian.png">
              <span class="chatName">{{data.0.userName}}</span>
              <span class="chatTime">{{data.2.createTime.month}}/{{data.2.createTime.day}}</span>
              <span class="chatPre">{{data.2.text}}</span>
            </li>
            {% endfor %}
          </div>
  
  
          <div class="col-md-10 m-0 p-0 h-100" style="border:1px solid grey">
  
            <div class="card-header">
              To：<strong class="text-center chatNameId"></strong>
            </div>
            <div class="chatContent p-4">
              {%for data in chatData%}
              <span data-id="{{data.0.id}}" class="chatContentId" style="display:none">
                {% for message in data.1 %}
                {% ifequal user.id message.sender_id %}
                <div class="bubble me">
                  {{message.text}}
                </div>
                <input type="hidden" class="messageId" value=" {{message.id}}">
                {% else %}
                <div class="bubble you">
                  {{message.text}}
                </div>
                <input type="hidden" class="messageId" value=" {{message.id}}">
                {%endifequal%}
                {%endfor%}
  
              </span>
              {% endfor %}
  
            </div>
            <div class="inputChat" style="display: none;">
              <input type="hidden" value="{{user.id}}" class="senderBox">
              <input type="text" class="inputBox">
              <li class="fa fa-send fa-lg"></li>
            </div>
  
          </div>
        </div>
      </div>



    </div>  
</div>

{% endblock %}


{% block privateJS %}
<script>

  $(document).ready(function () {
    setInterval(updateMsg,500);
    $(".con-left-content").click(function () {
      var sonid = $(this).attr("data-son-id");
      $(".content-right").hide();
      $(sonid).show();
    });
    $(".inputChat li").click(function () {
      var text = $(".inputChat .inputBox").val();
      var id_send = $(".inputChat .senderBox").val();
      var id_receive = $(".chatPeopleList .active").attr("data-id");
      var data = { "text": text, 'post_type': "send_chat", "id_send": id_send, "id_receive": id_receive };
      if(text == ""){
        return ;
      }
      $.post("/personal/post/",
        data,
        function (data) {
          $(".inputChat .inputBox").val("");  //消息发送成功后清空内容框  
        }, 'text');
    });

    $(".chatPeople").click(function () {
      $(".inputChat").show();
      $(".chatPeople").removeClass("active");
      $(this).addClass("active");
      var chatId = $(this).attr("data-id");
      $(".chatNameId").text($(this).find(".chatName").text() + "老师");
      $(".chatContentId").hide();
      $(".chatContentId[data-id=" + chatId + "]").show();
    })
    $(document).keydown(function(){
        if (event.keyCode == 13) {
          $(".inputChat li").click();
        }
    });  //当按下键盘"enter"时，触发按钮点击
  })

  function updateMsg() {
    send_data = [];
    var id_send = $(".inputChat .senderBox").val()
    $(".chatContentId").each(function () {
      var last_chat_id = $(this).find(".messageId").last().val();
      var id_receive = $(this).attr("data-id");
      tempDic = { "last_chat_id": last_chat_id, "id_receive": id_receive }
      send_data.push(tempDic)
    })

    $.post(
      "/personal/post/",
      {
        "id_send": id_send,
        "send_data": JSON.stringify(send_data),
        "post_type": 'get_chat'
        // 请求所需数据
      },
      function (data) {
        for (var i = 0; i < data.length; i++) {
          for (var j = 0; j < data[i].length; j++) {
            if (data[i][j][1] == $(".inputChat .senderBox").val()) {
              $('.chatContentId').append('<div class="bubble you">' + data[i][j][0] + '</div>');
              $('.chatContentId').append('<input type="hidden" class="messageId" value="' + data[i][j][2] + '">');
            }
            else {
              $('.chatContentId').append('<div class="bubble me">' + data[i][j][0] + '</div>');
              $('.chatContentId').append('<input type="hidden" class="messageId" value="' + data[i][j][2] + '">');
            }
          }
        }
      });
  }
</script>
{% endblock %}